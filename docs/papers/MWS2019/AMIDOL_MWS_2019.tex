\documentclass[11pt]{article}
\usepackage[parfill]{parskip}
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{subcaption}
\usepackage[top=1in, bottom=1in, left=1in, right=1in]{geometry}
\bibliographystyle{plain}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{hyperref}
\usepackage[T1]{fontenc}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{fancyhdr}
\pagestyle{fancy}
%%% Please add the author's last names
\lhead{Davis, Theriault, Orhai, Westbrook, and Wright}
\rhead{Modeling the World's Systems, 2019}
%%% Please use \cfoot{} to remove page numbers
\cfoot{ }
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%&
\usepackage{titlesec}
\titlespacing{\section}{0pt}{\parskip}{-.5\parskip}
\titlespacing{\subsection}{0pt}{\parskip}{- .5\parskip}
\titlespacing{\subsubsection}{0pt}{\parskip}{- .5\parskip}
\newcommand{\closeup}{\setlength{\itemsep}{-4pt}}

\newcommand{\amidol}{\textsc{AMIDOL}}

\def\signed #1{{\leavevmode\unskip\nobreak\hfil\penalty50\hskip2em
  \hbox{}\nobreak\hfil(#1)%
  \parfillskip=0pt \finalhyphendemerits=0 \endgraf}}

\newsavebox\mybox
\newenvironment{aquote}[1]
  {\savebox\mybox{#1}\begin{quote}}
  {\signed{\usebox\mybox}\end{quote}}

\date{\vspace{-5ex}}
% Use this to get rid of the date

\usepackage{authblk}
\author{Eric Davis}
\author{Alec Theriault}
\author{Eddy Westbrook}
\author{Ryan Wright}
\affil{Galois, Inc}

%\setcounter{page}{0}



\title{Machine-Assisted Extraction of Formal Semantics from Domain Specific Semi-Formal Diagrams}

\begin{document}
\maketitle
\vspace{10pt}
\begin{abstract}
Analyzing complex systems is a challenging process which requires not only teams of domain experts but often also a multidisciplinary team of data scientists, mathematicians, statisticians, and software engineers in order to support the life cycle of model development, model-based inference, as well as knowledge extraction and synthesis.  The models that typically result from this process today are bespoke, lack generalizability, are not performable, lack reusability, and make the task of synthesizing actionable knowledge and policies from their raw outputs difficult.  In this paper we describe \amidol{}: the Agile Metamodel Inference using Domain-specific Ontological Languages, a project that aims to reduce the overhead associated with the development, deployment, maintenance, and reuse of models of complex systems.  Our technique utilizes a common intermediate representation which is designed to support a number of scientific, physical, social, and hybrid domains by allowing domain experts to define their models in a novel way: using domain specific ontological languages (VDSOLs).  The intermediate abstract representation provides formal, executable, meaning to the semi-formal diagrams domain experts normally create, and allows the inference engine to build prognostic queries on associated reward models.  \amidol{} binds results from the inference engine to the original ontologies providing more explainability when compared to conventional methods.
\end{abstract}

\section{Introduction}

The construction of computational models is an important practice for scientists, engineers, policy makers, and other domain experts as it provides a way to make formal predictions based on a formal expectation of system behavior, and allows practitioners to test hypotheses and explain phenomena in complex systems.  The process of building suitable models, however, is a laborious one which requires diverse teams of experts, significant manual effort, and typical results in models with severe limitations, low performability, and little reusability or generalizability.  Such models are not only costly to produce, both in time and effort, but are also prone to errors, difficult to verify, and do not utilize best practices in software development.

\amidol{} seeks to improve the problems inherent to modern machine-assisted inference with two high-level goals: 1) improving the ability of domain experts to build and maintain models and 2) improving the explainability and agility of the results of machine-inference.  The techniques applied to achieve these goals incorporate abstract intermediate representations, semantic knowledge representation and binding in graph structures, traditional machine learning and model solution techniques, with intuitive model generation giving meaning to the semi-formal diagrams already being generated by domain experts.

\begin{figure}
  \centering
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{figs/Diagram_of_meiosis.pdf}
    \caption{Example of a semi-formal diagram of Meoisis. CC-BY-SA 3.0 Marek Kultys, July 2, 2008.}
    \label{Fig:Meiosis}
  \end{subfigure}
  \begin{subfigure}[b]{0.48\textwidth}
    \includegraphics[width=\textwidth]{figs/HIV-Tat-figure.pdf}
    \caption{Example of a semi-formal diagram of the molecular model of the Tat transactivation circuit.}
    \label{Fig:HIV-Tat}
  \end{subfigure}
  \caption{Examples of semi-formal diagrams drawn by domain experts to represent operational semantics and complex
  system models.}
  \label{Fig:Semi-formal}
\end{figure}

Current modeling formalisms are often specified in formal languages which seem arcane and unnatural to domain experts, but have unambiguous formal meaning with defined execution semantics.  By contrast domain experts have naturally developed visual semi-formal ways of describing the systems they study, such as those illustrated in Figure \ref{Fig:Semi-formal}, but which lack semantic meaning, executability, and are often ambiguous.  In Luca Cardelli's paper on the abstract machines of systems biology \cite{cardelli2005abstract} he notes that these semi-formal diagrams come close to capturing the operational semantics of process algebras, a concept he expanded on when deriving a formal calculus of membrane interactions \cite{cardelli2004brane}.  Similarly, a need for formal languages which describe biological systems similar to those used in physics or chemistry was highlighted in Paul Nurse's 2008 paper \cite{nurse2008life}:

\begin{aquote}{Paul Nurse (2008)}
"There should be
a concerted programme \ldots which will require both the development of
the appropriate languages to describe information processing in biological systems and the generation of more effective methods to
translate biochemical descriptions into the
functioning of the logic circuits that underpin
biological phenomena."
\end{aquote}

\paragraph{Significance}
\amidol{} seeks to provide a framework for the development of languages which formally describe biological systems and complex systems from other domains using an abstract intermediate representation which serves as a universal modeling language.  This framework provides several significant advancements on the state of the art which seek to improve the usability, maintainability, reusability, and performability of scientific models.  First, \amidol{} will provide compilers that translate from many Visual Domain Specific Ontological Languages (VDSOLs) into its abstract intermediate representation allowing VDSOLs to be specified for new domains and extended easily, and models written in VDSOLs to be transformed into a universal representation that preserves metadata about the original ontology.  Second, \amidol{} will provide transformations on models in its abstract intermediate representation to optimize the execution of these models, compose models to build more powerful and complex representations, and to overlay reward structures on these models to specify metrics of interest and experiments to perform with \amidol{}'s inference engine.  Finally, \amidol{} provides compilers that translate models in the abstract intermediate representation into solver targets for the inference engine, checking constraints of composed reward structures, to solve for measures of interest.  \amidol{} allows these results to be communicated back to the user through the saved metadata, to relate raw statistical and machine learning output to the original ontology to improve explainability.

\section{AMIDOL}

\begin{figure}
  \includegraphics[width=\textwidth]{figs/system-architecture-quad.pdf}
  \caption{\amidol{} Architecture}
  \label{Fig:Architecture}
\end{figure}

Figure \ref{Fig:Architecture} outlines the architecture, and usage pattern for \amidol{}.  \amidol{}'s front end allows the user to define their model in one of a number of predefined VDSOLs in the form of directed graphs connecting nouns and verbs together.  Each noun or verb has an underlying representation in the abstract intermediate representation into which it is translated by \amidol{}.  These representations are then composed together with state sharing, and then composed with reward models which define metrics of interest.  The resulting composed model can be further transformed in the abstract intermediate representation for performability, efficiency, or similar reasons.  After transformations of this sort are complete, \amidol{} translates the model into a back end solver, and associates these results with a node in a graph database for experimental results.  These results are communicated back to the domain expert using the original ontology to provide better explainability.

\subsection{Visual Domain Specific Languages}

\amidol{} is designed to support the definition of ontological languages which describe systems as formal objects.  Objects for a given domain are organized into \emph{toolkits} consisting of \textbf{nouns} and \textbf{verbs}.  Nouns define elements which make up the state space of a system, and verbs define transitions in the state space.  VDSOLs enable domain experts to build models of complex systems which are easier to maintain, validate, and verify, and avoid common pitfalls of monolithic and hand-coded implementations.  To provide visual context for modelers, \amidol{} supports the use of arbitrary scalable vector graphics (SVGs) to represent nouns and verbs, and features a canvas to draw nouns and verbs with labeled arcs connecting them to provide context.

VDSOLs in \amidol{} are constructed using a graphical user interface implemented using asynchronous javascript and XML to build a responsive interface to define models of complex systems, reward models used to explore and understand complex system behavior, and to interact with the results of solvers implemented in the Machine-Assisted Inference Engine.

\subsection{Composability of Atomic Models}

\amidol{} is being designed to support the composition of individual models to enable model reuse, compositional methods for solution, to enhance backend support for performance optimizations that require symmetry detection, and to allow domain scientists to experiment by swapping out components of a model which may represent complex hypotheses about individual elements.  Model composition in \amidol{} is being designed to support two primary mechanisms: \emph{state-sharing} \cite{sanders1992dependability,sanders1988construction} and \emph{event-synchronization} \cite{lampka2002symbolic}.

\subsection{Intermediate Representation}

The Abstract Intermediate Representation (IR) for \amidol{} is meant to be a universal way to specify models, regardless of their domain, and provides a Turing-complete way to specify models performably, while avoiding domain specific considerations.

The IR employed by \amidol{} has its roots in Markov models \cite{howard2012dynamic}, Generalized Stochastic Petri-nets with inhibitor arcs \cite{chiola1993generalized} which have been shown to be Turing complete, and stochastic activity networks \cite{movaghar1985performability,sanders2000stochastic} which are extensions of Petri-nets that allow more compact model specification.  \amidol{} currently extends these concepts by creating ways to link to the original ontology of nouns and verbs, and by allowing embedded reward structures to be linked to a graph-based results database which stores the outcomes of experiments and can be used for the construction of arbitrary measures on the underlying model to support inference needs.

Formally, the IR is a 5-tuple, $(S, E, L, \Phi, \Lambda, \Delta)$ where:
\begin{itemize}
\item $S$ is a finite set of state variables $\{s_0, s_1, \ldots, s_{n-1}\}$ that take on values in $\mathbb{N}$.
\item $E$ is a finite set of events $\{e_0, e_1, \ldots, e_{m-1}\}$ that may occur in the model.
\item $L: S|E \rightarrow \mathbb{N}$ is the event and state variable labeling function that maps elements of $S$ and $E$ into the original ontology.
\item $\Phi: E \times N_0 \times N_1 \times \ldots \times N_{n-1} \rightarrow \{0, 1\}$ is the event enabling predicate.
\item $\Lambda: E \times N_0 \times N_1 \times \ldots \times N_{n-1} \rightarrow (0, \infty)$ is the transition rate specification.
\item $\Delta: E \times N_0 \times N_1 \times \ldots \times N_{n-1} \rightarrow N_0 \times N_1 \times \ldots \times N_{n-1}$ is the state variable transition function specification.
\end{itemize}

Informally the IR represents models defined in a given VDSOL using an formalism based on Generalized Stochastic Petri-nets with inhibitor arcs.  Instead of inhibitor arcs, we utilize the more intuitive and performable method of allowing events to have input predicates ($\Phi$) which can be evaluated to determine if an event is enabled, and output predicates which define the side effects of event firing.

Intuitively, \textbf{state-variables} make up the current state of the model, and measure the configuration and capabilities of all modeled components.  While state variables are defined as taking on values in $\mathbb{N}$, this does not restrict them from representing real numbers to arbitrary precision in modern computer hardware.  In practice, they are implemented as integers, and floating point numbers by the \amidol{} source code.

\textbf{Events}, when fired, change the state of a model by altering the value of state variables.  Events in \amidol{} are associated with input predicates, output predicates, and a rate function which returns the next firing time of a given event.  The rate function is an expression over random variable distributions.

An \textbf{input predicate} is associated with an event, and a potentially empty set of state variables.  Input predicates are functions of the marking of their set of variables which map the markings of those variables onto the set $\{1, 0\}$.  For those markings in which the input predicate evaluates to $1$, the event is considered enabled and will fire as normal.  For those markings in which the input predicate evaluates to $0$, the event is considered disabled and cannot fire until subsequently enabled.  An \textbf{output predicate} is associated with an event, and a potentially empty set of state variables.  Output predicates map a set of state variables, and their marking, to a new marking for the same state variables and define the side effects of event firing on the state of the model.

\section{Reward Variables, Reward Models, and Inference}

The \amidol{} intermediate representation allows for the specification of reward variables or structures over a given model, and the composition of these structures with a model to produce composed models which can then be solved by the inference engine.  We define two basic types of rewards structures, rewards over state variable values (rate rewards), and rewards over events (impulse rewards). \cite{qureshi1996algorithms,deavours1999efficient,ciardo1996well,sanders1991reduced}
A rate reward is formally defined as a function $\mathcal{R}: P(S, \mathbb{N}) \rightarrow \mathbb{R}$ where $q \in P(S, \mathbb{N})$ is the reward accumulated when for each $(s,n) \in q$ the marking of the state variable $s$ is $n$.  Informally a rate reward variable $x$ accumulates a defined reward whenever a subset of the state variables take on prescribed values. An impulse reward is formally defined as a function $\mathcal{I}: E \rightarrow \mathbb{R}$ where $e \in E, \mathcal(I)_e$ is the reward for the completion of $e$.  Informally an impulse reward variable $x$ accumulates a defined reward whenever the event $e$ fires.

Both rate and impulse reward variables measure the behavior of a model $M$ with respect to time.  As such, a reward variable $\theta$ is declared as either an instant-of-time variable, an interval-of-time variable, a time-averaged interval-of-time variable, or a steady state variable.  An instant of time variable $\Theta_t$ is defined as:

\[ \theta_t = \sum_{\nu \in P(S, \mathbb{N})} \mathcal{R}(\nu) \cdot \mathcal{I}^{\nu}_t + \sum_{e \in E} \mathcal{I}(e) \cdot I_t^e\]

Intuitively a rate reward declared as an instant-of-time variable \cite{freire1990technique} can be used to measure the value of a state variable precisely at time $t$, and an impulse reward declared as an instant-of-time variable can be used to measure whether a given event fired at precisely time $t$.  While the latter is not a particularly useful measure (as the probability of an event with a firing time drawn from a continuous distribution at time $t$ is $0$) it is defined for closure reasons, and for cases with discrete distributions and discrete time steps.

An interval-of-time variable intuitively accumulates reward over some fixed interval of time $[t, t+1]$.  Given such a variable $\theta_{[t, t+1]}$ we formally define interval-of-time variables as:

\[\theta_{[t,t+1]} = \sum_{\nu \in P(S, \mathbb{N})} \mathcal{R}(\nu) \cdot \mathcal{J}^{\nu}_{[t, t+1]} + \sum_{e \in E} \mathcal{I}(e)N^e_{[t,t+1]}\]

where $J^{\nu}_{[t,t+1]}$ is a random variable which represents the total time the model spent in a marking such that for each $(s, n) \in \nu$, the state variable $s$ has a value of $n$ during the period $[t, t+1]$. $I^e_{t\rightarrow\infty}$ is a random variable which represents the number of times an event $e$ has fired during the period $[t, t+1]$.

Time-averaged interval of time variables quantify accumulated reward over some interval of time.  Such a variable $\theta'_{[t,t+1]}$ is defined formally as $\theta'_{[t,t+1]} = \frac{\theta_{[t,t+1]}}{l}$.

Steady state reward variables are realized by testing for initial transients, and calculating an instant of time variable after a model has reached a stable steady state with high confidence.

\section{Conclusions}

We are currently testing \amidol{} using the SIS/SIRS compartmental model of epidemiology.  While simple, the SIS/SIRS model utilizes real data from the CDC, and has a strong set of predictive capabilities.  The primary objective of the SIS/SIRS model is to identify the \emph{basic reproduction number} associated with an infection, also known as $R_0$. The importance of estimating $R_0$ has been well established for many historical epidemics, including H1N1 \cite{fraser2009pandemic} and Ebola \cite{fisman2014early}.  This model also lends itself to testing \amidol{}'s Design of Experiments module via the plentiful CDC Data \cite{cdc2019fluview} which is well modeled by SIRS.

Our initial tests with \amidol{} suggest that the framework can reduce the reliance of domain experts on bespoke and custom code.  By providing a intermediate representation which is Turing complete, and expressive enough to allow the IR to be transformed to improve performance or tractability, such as when solving stiff systems of ODEs \cite{enright1975comparing} we hope to enable domain experts to leverage the work of software engineers and mathematicians in a repeatable, and reusable way.  By providing a common language for the expression of models and reward structures we hope to improve model maintainability, and to improve the ability of domain experts to share their results, and leverage models created by others in their domain, or even in adjacent domains.  The end goal of \amidol{} is to create a community around this new framework similar to that of LLVM \cite{lattner2004llvm} with an open API for writing transformers for the IR, and repositories of VDSOLs and models, enabling more repeatable science utilizing machine-assisted inference.

\section{Acknowledgments}

This research has been supported by DARPA contract DARPA-PA-18-02-AIE-FP-039.

\section{Resources, web sites, etc.}

MWS seeks to build a community and share resources, so feel free to have a section in your paper that points readers to web sites, github pages, etc.


%\newcommand*{\doi}[1]{\href{http://dx.doi.org/#1}{doi: #1}}
\bibliography{AMIDOL-MWS}



\end{document}
